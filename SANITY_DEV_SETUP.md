# Sanity Development Studio Setup

This script creates a completely new Sanity project for testing purposes, separate from your production project.

## What It Does

1. **Detects** your Sanity project (current directory, `sanity/` subdirectory, or custom path)
2. **Exports** your existing production data
3. **Creates** a brand new Sanity project 
4. **Clones** your studio configuration
5. **Imports** the production data into the new project
6. **Sets up** a complete development environment

## Prerequisites

- Node.js and npm installed
- Sanity CLI available (`npx sanity --version`)
- Logged into Sanity (`npx sanity login`)
- `jq` installed (optional, for better JSON parsing)
- Existing Sanity project (in current directory, `sanity/` subdirectory, or custom path)

### Install jq (if not available)
```bash
# macOS
brew install jq

# Ubuntu/Debian
sudo apt-get install jq

# Windows (with Chocolatey)
choco install jq
```

## Usage

1. **Run the script from any of these locations:**
   ```bash
   # From Sanity project root (has sanity.config.ts/js)
   chmod +x sanity-dev-setup.sh
   ./sanity-dev-setup.sh
   
   # From parent directory (has sanity/ subdirectory)
   chmod +x sanity-dev-setup.sh
   ./sanity-dev-setup.sh
   
   # From anywhere (script will ask for Sanity directory path)
   chmod +x sanity-dev-setup.sh
   ./sanity-dev-setup.sh
   ```

2. **Follow the prompts** - the script will:
   - Detect your Sanity project automatically
   - Show you what it will do
   - Ask for confirmation
   - Create the new project
   - Set up the development studio

3. **Start your development studio:**
   ```bash
   cd sanity-dev-studio
   npm run dev
   ```

## What Gets Created

### New Sanity Project
- **Project Name**: `sanity-dev-test-YYYYMMDD_HHMMSS`
- **Project ID**: Auto-generated by Sanity
- **Dataset**: `production` (with your imported data)

### Development Studio Directory
- **Location**: `sanity-dev-studio/`
- **Configuration**: Points to the new project
- **Data**: Complete copy of your production data

## Available Scripts

In the `sanity-dev-studio/` directory:

```bash
# Start the development studio
npm run dev

# Re-import the backup data
npm run import-backup

# Reset and re-import data
npm run reset-dev

# Deploy the studio
npm run deploy
```

## Environment Variables

The script creates a new `.env` file with:
- `SANITY_STUDIO_PROJECT_ID`: Your new project ID
- `SANITY_STUDIO_DATASET`: `production`
- `SANITY_STUDIO_PREVIEW_URL`: Empty (for local development)
- `SANITY_STUDIO_STUDIO_HOST`: `sanity-dev-test`

## Benefits

✅ **Completely Isolated**: No risk to your production data  
✅ **Full Copy**: All your schemas, data, and configuration  
✅ **Easy Cleanup**: Just delete the project when done  
✅ **No Dataset Limits**: Create as many test projects as needed  
✅ **Production-like**: Uses the same schemas and data structure  

## Cleanup

When you're done testing:

1. **Delete the local directory:**
   ```bash
   rm -rf sanity-dev-studio/
   ```

2. **Delete the Sanity project:**
   - Go to [sanity.io/manage](https://sanity.io/manage)
   - Find your test project
   - Delete it

## Troubleshooting

### "Failed to create new Sanity project"
- Make sure you're logged in: `npx sanity login`
- Check you have permission to create projects
- Verify your internet connection

### "jq not found"
- Install jq (see Prerequisites above)
- Or the script will use a fallback method

### "Export failed"
- Check your source project ID and dataset name
- Ensure you have read access to the source project
- Verify the dataset exists

## Example Output

```
[INFO] Starting Sanity Development Studio setup...
[INFO] Detected Sanity project in current directory
[INFO] Checking prerequisites...
[SUCCESS] Prerequisites check passed
[INFO] Reading project configuration from .
[INFO] Source Project ID: l3u4li5b
[INFO] Source Dataset: production
[INFO] New Project Name: sanity-dev-test-20241218_143022

[INFO] This will:
[INFO] 1. Export your 'production' dataset from project 'l3u4li5b'
[INFO] 2. Create a NEW Sanity project: 'sanity-dev-test-20241218_143022'
[INFO] 3. Create a new development studio in 'sanity-dev-studio'
[INFO] 4. Import the exported data into the new project's production dataset
[WARNING] This creates a completely separate Sanity project for testing!

Continue? (y/N): y

[INFO] Exporting data from dataset: production
[SUCCESS] Created new project with ID: abc123def456
[INFO] Setting up development studio...
[INFO] Importing data to new project...
[SUCCESS] Development studio setup completed!

[INFO] New Sanity Project ID: abc123def456
[INFO] Development studio location: sanity-dev-studio/
[INFO] Dataset: production
[INFO] Backup file: sanity-dev-studio/sanity-backup-20241218_143022.tar.gz

[INFO] To start your development studio:
  cd sanity-dev-studio
  npm run dev

[INFO] Your new project is completely separate from your original project!
```

## Security Notes

- The new project is completely isolated from your production project
- All data is copied, not shared
- You can safely test schema changes without affecting production
- The test project uses the same schemas but different data